<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSSC Boarding House - Maintenance Requests</title>
    <link rel="stylesheet" href="css/all.min.css">
    <script src="js/jquery-3.6.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="jquery-3.6.1.min.js"><\/script>');</script>
    <style>
        /* Combined CSS from student-common.css and maintenance-specific styles */
        
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-blue: #1a4f8b;
            --secondary-blue: #2c6aa0;
            --light-blue: #e6f0f7;
            --accent: #ff6b00;
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #f94144;
            --dark-text: #333;
            --light-text: #fff;
            --gray-bg: #f8f9fa;
            --bg-body: #f5f7fb;
            --bg-surface: #ffffff;
            --bg-elevated: #ffffff;
            --bg-header: #ffffff;
            --bg-sidebar: #ffffff;
            --bg-card: #ffffff;
            --bg-dropdown: #ffffff;
            --bg-profile: #f9f9f9;
            --bg-hover: #f8f9fa;
            --text-primary: #333;
            --text-secondary: #6c757d;
            --text-muted: #666;
            --border-light: #e9ecef;
            --border-medium: #dee2e6;
            --border-heavy: #dee2e6;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.2);
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --header-height: 80px;
            --sidebar-width: 250px;
        }

        body.dark-mode {
            --bg-body: #121826;
            --bg-surface: #1a2236;
            --bg-elevated: #202940;
            --bg-header: #1a2236;
            --bg-sidebar: #1a2236;
            --bg-card: #1a2236;
            --bg-dropdown: #1a2236;
            --bg-profile: #161d2e;
            --text-primary: #f5f7fb;
            --text-secondary: #c2c6d1;
            --text-muted: #c2c6d1;
            --border-light: #2a3245;
            --border-medium: #2a3245;
            --border-heavy: #2a3245;
            --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 5px 20px rgba(0, 0, 0, 0.25);
            --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.3);
            --bg-hover: #2a3245;
        }

        body {
            color: var(--text-primary);
            line-height: 1.6;
            background-color: var(--bg-body);
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Login Animation */
        .login-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-body);
            display: flex !important;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .login-animation.hide {
            opacity: 0;
            visibility: hidden;
            display: none !important;
        }

        .animation-content {
            text-align: center;
            position: relative;
        }

        .icon-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin: 0 auto 20px;
            background: radial-gradient(circle, rgba(67, 97, 238, 0.4) 0%, rgba(67, 97, 238, 0) 70%);
            animation: backgroundPulse 2s ease-in-out infinite;
        }

        .student-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 4rem;
            color: var(--primary-blue);
            opacity: 0;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out, color 1s ease-in-out;
        }

        .student-icon.show-icon {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            animation: pulse 1s ease-in-out infinite alternate, colorShift 2s ease-in-out infinite;
        }

        @keyframes backgroundPulse {
            0% { background: radial-gradient(circle, rgba(67, 97, 238, 0.4) 0%, rgba(67, 97, 238, 0) 70%); }
            50% { background: radial-gradient(circle, rgba(67, 97, 238, 0.6) 0%, rgba(67, 97, 238, 0) 70%); }
            100% { background: radial-gradient(circle, rgba(67, 97, 238, 0.4) 0%, rgba(67, 97, 238, 0) 70%); }
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            100% { transform: translate(-50%, -50%) scale(1.15); }
        }

        @keyframes colorShift {
            0% { color: var(--primary-blue); }
            50% { color: #ffffff; }
            100% { color: var(--primary-blue); }
        }

        /* Student Container */
        #studentContainer {
            display: none !important;
        }

        #studentContainer.show {
            display: block !important;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        /* Student Portal Header */
        .admin-header {
            background-color: var(--bg-header);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-secondary);
            display: block;
        }

        .header-left h1 {
            color: var(--primary);
            font-size: 1.8rem;
        }

        .header-left h1 i {
            margin-right: 0.5rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        /* Student Profile */
        .admin-profile {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.7rem;
            padding: 0.5rem;
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        .admin-profile:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .admin-profile:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .admin-profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        /* Student Profile Dropdown */
        .admin-profile-dropdown {
            position: fixed;
            width: 300px;
            background: var(--bg-dropdown);
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            z-index: 1001;
            display: none;
            padding: 10px 0;
        }

        .admin-profile-dropdown.show {
            display: block;
            animation: fadeInDropdown 0.3s ease;
        }

        @keyframes fadeInDropdown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-header {
            display: flex;
            padding: 15px 20px;
            align-items: center;
        }

        .dropdown-header img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .user-info h4 {
            margin: 0 0 5px 0;
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-info p {
            margin: 0 0 5px 0;
            color: var(--text-muted);
            font-size: 0.9em;
        }

        .user-role {
            background: var(--primary);
            color: var(--light-text);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border-medium);
            margin: 8px 0;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            text-decoration: none;
            color: var(--text-primary);
            transition: background-color 0.3s;
            cursor: pointer;
        }

        .dropdown-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .dropdown-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .dropdown-item i {
            margin-right: 12px;
            min-width: 16px;
            text-align: center;
        }

        .logout-item {
            color: var(--danger);
        }

        .logout-item i {
            color: var(--danger);
        }

        /* Student Body */
        .admin-body {
            display: flex;
            min-height: calc(100vh - var(--header-height));
            padding-top: var(--header-height);
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--bg-sidebar);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            padding: 1.5rem 0;
            transition: transform 0.3s ease;
            position: fixed;
            top: var(--header-height);
            bottom: 0;
            z-index: 99;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s;
            gap: 0.8rem;
        }

        .nav-item:hover {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }

        .nav-item.active {
            background-color: var(--primary);
            color: var(--light-text);
            border-left: 4px solid var(--accent);
        }

        /* Content */
        .admin-content {
            flex: 1;
            padding: 2rem;
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease;
        }

        .admin-content.expanded {
            margin-left: 0;
        }

        /* Common Dashboard Styles */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            padding: 20px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .section-title {
            font-size: 1.6rem;
            color: var(--primary-blue);
            margin-bottom: 1rem;
        }

        .action-btn {
            background: var(--primary-blue);
            color: var(--light-text);
            border: none;
            padding: 11px 30px;
            border-radius: var(--border-radius);
            font-size: 1rem;
            display: inline-block;
            margin: 15px 0 0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .action-btn:hover {
            background: var(--secondary-blue);
        }

        /* Maintenance Specific Styles */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Enhanced Dropdown Styling */
        .form-group select#issue-type {
            width: 100%;
            padding: 12px;
            border: 1px solid #4361ee;
            border-radius: 8px;
            background-color: #f9f9f9;
            font-size: 16px;
            color: #333;
            transition: all 0.3s ease;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%234361ee" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            cursor: pointer;
        }

        .form-group select#issue-type:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(67, 97, 238, 0.5);
            border-color: #1e3a8a;
        }

        .form-group select#issue-type:hover {
            background-color: #e6e6ff;
        }

        .form-group select#issue-type option {
            background-color: #fff;
            color: #333;
        }

        /* Enhanced Textarea Styling */
        .form-group textarea#issue-description {
            width: 100%;
            padding: 12px;
            border: 1px solid #4361ee;
            border-radius: 8px;
            background-color: #f9f9f9;
            font-size: 16px;
            color: #333;
            resize: vertical;
            min-height: 100px;
            transition: all 0.3s ease;
        }

        .form-group textarea#issue-description:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(67, 97, 238, 0.5);
            border-color: #1e3a8a;
        }

        .form-group textarea#issue-description:hover {
            background-color: #e6e6ff;
        }

        .form-group .character-counter {
            font-size: 14px;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }

        .form-group .character-counter.error {
            color: #dc2626;
        }

        /* Enhanced Maintenance Request Cards */
        .announcement-item {
            background-color: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 12px;
            padding: 16px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            animation: fadeIn 0.5s ease-in;
            cursor: pointer;
        }

        .announcement-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .announcement-item .announcement-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .announcement-item .announcement-text h4 {
            margin: 0 0 8px;
            font-size: 18px;
            color: #1e3a8a;
        }

        .announcement-item .announcement-text p {
            margin: 0 0 8px;
            color: #4b5563;
        }

        .announcement-item .announcement-text p small {
            color: #6b7280;
        }

        .announcement-item .status-pending {
            background-color: #fef3c7;
            color: #d97706;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .announcement-item .status-resolved {
            background-color: #d1fae5;
            color: #059669;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .announcement-item .toggle-description {
            color: #4361ee;
            cursor: pointer;
            font-size: 14px;
            text-decoration: underline;
            display: inline-block;
            margin-bottom: 8px;
        }

        .announcement-item .full-description {
            display: none;
            margin-top: 8px;
            color: #4b5563;
        }

        /* Action Container */
        .action-container {
            display: none;
            margin-top: 12px;
            padding: 12px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background-color: #f9f9f9;
            animation: slideDown 0.3s ease;
        }

        .action-container .action-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .action-container button {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .action-container .edit-btn {
            background-color: #4361ee;
            color: #fff;
        }

        .action-container .edit-btn:hover {
            background-color: #1e3a8a;
        }

        .action-container .delete-btn {
            background-color: #dc2626;
            color: #fff;
        }

        .action-container .delete-btn:hover {
            background-color: #b91c1c;
        }

        .action-container .cancel-btn {
            background-color: #6b7280;
            color: #fff;
        }

        .action-container .cancel-btn:hover {
            background-color: #4b5563;
        }

        /* Edit Form within Action Container */
        .action-container .edit-form {
            display: none;
            padding: 12px;
            border: 1px solid #4361ee;
            border-radius: 8px;
            background-color: #fff;
        }

        .action-container .edit-form .form-group {
            margin-bottom: 12px;
        }

        .action-container .edit-form select,
        .action-container .edit-form textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #4361ee;
            border-radius: 4px;
            font-size: 14px;
        }

        .action-container .edit-form .save-btn {
            background-color: #059669;
            color: #fff;
        }

        .action-container .edit-form .save-btn:hover {
            background-color: #047857;
        }

        .action-container .edit-form .cancel-btn {
            background-color: #6b7280;
            color: #fff;
        }

        .action-container .edit-form .cancel-btn:hover {
            background-color: #4b5563;
        }

        .action-container .edit-form .character-counter {
            font-size: 12px;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }

        .action-container .edit-form .character-counter.error {
            color: #dc2626;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Screen Reader Only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        /* Profile Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            max-width: 500px;
            width: 90%;
            padding: 20px;
            text-align: center;
        }

        #profileModal .profile-modal {
            max-width: 900px !important;
            max-height: 95vh;
            overflow-y: auto;
            width: 95% !important;
        }

        #profileModal .profile-tabs {
            display: flex;
            border-bottom: 2px solid var(--border-light);
            margin-bottom: 20px;
            background: var(--bg-card);
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        #profileModal .profile-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        #profileModal .profile-tab:hover {
            color: var(--primary-blue);
            background: var(--bg-hover);
        }

        #profileModal .profile-tab.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
            font-weight: 600;
        }

        #profileModal .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        #profileModal .tab-content.active {
            display: block;
        }

        #profileModal .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
            margin: -20px -20px 20px -20px;
            box-shadow: var(--shadow-sm);
        }

        #profileModal .profile-avatar-container {
            position: relative;
            flex-shrink: 0;
        }

        #profileModal .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            object-fit: cover;
            background: var(--light-text);
        }

        #profileModal .change-avatar-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: var(--primary-blue);
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        #profileModal .change-avatar-btn:hover {
            background: var(--secondary-blue);
            transform: scale(1.1);
        }

        #profileModal .profile-info-header h2 {
            margin: 0 0 5px 0;
            font-size: 1.6rem;
            font-weight: 700;
        }

        #profileModal .profile-info-header p {
            margin: 0 0 15px 0;
            opacity: 0.9;
            font-size: 1rem;
        }

        #profileModal .profile-badges {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        #profileModal .profile-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        #profileModal .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        #profileModal .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        #profileModal .form-group.full-width {
            grid-column: 1 / -1;
        }

        #profileModal .form-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        #profileModal .form-input {
            padding: 12px 14px;
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 0.95rem;
            transition: all 0.3s ease;
            width: 100%;
        }

        #profileModal .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        #profileModal .form-input:read-only {
            background: var(--bg-hover);
            color: var(--text-muted);
            cursor: not-allowed;
        }

        #profileModal .profile-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 25px 0;
            padding: 20px;
            background: var(--bg-hover);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-light);
        }

        #profileModal .stat-item {
            text-align: center;
            padding: 20px 15px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            transition: all 0.2s ease;
        }

        #profileModal .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        #profileModal .stat-icon {
            font-size: 1.8rem;
            color: var(--primary-blue);
            margin-bottom: 10px;
        }

        #profileModal .stat-number {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary-blue);
            display: block;
        }

        #profileModal .stat-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        #profileModal .activity-list {
            max-height: 350px;
            overflow-y: auto;
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            background: var(--bg-card);
        }

        #profileModal .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 16px;
            border-bottom: 1px solid var(--border-light);
        }

        #profileModal .activity-item:last-child {
            border-bottom: none;
        }

        #profileModal .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            flex-shrink: 0;
        }

        #profileModal .activity-content {
            flex: 1;
        }

        #profileModal .activity-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        #profileModal .activity-time {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        #profileModal .preferences-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        #profileModal .preference-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
        }

        #profileModal .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        #profileModal .toggle-checkbox {
            opacity: 0;
            width: 0;
            height: 0;
        }

        #profileModal .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--text-muted);
            transition: .4s;
            border-radius: 34px;
        }

        #profileModal .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        #profileModal .toggle-checkbox:checked + .toggle-slider {
            background-color: var(--success);
        }

        #profileModal .toggle-checkbox:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        #profileModal .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-light);
        }

        #profileModal .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            min-width: 120px;
            justify-content: center;
        }

        #profileModal .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        #profileModal .btn-primary:hover {
            background: var(--secondary-blue);
        }

        #profileModal .btn-secondary {
            background: var(--danger);
            color: white;
        }

        #profileModal .btn-secondary:hover {
            background: #d32f2f;
        }

        #profileModal .btn-outline {
            background: transparent;
            border: 1px solid var(--border-light);
            color: var(--text-primary);
        }

        #profileModal .btn-outline:hover {
            background: var(--bg-hover);
        }

        /* Edit Mode Styles */
        #profileModal .edit-mode .form-input:not([readonly]) {
            background: white !important;
            border-color: var(--primary-blue) !important;
            color: var(--text-primary) !important;
            cursor: text !important;
        }

        body.dark-mode #profileModal .edit-mode .form-input:not([readonly]) {
            background: var(--bg-surface) !important;
            color: var(--text-primary) !important;
        }

        /* Dark Mode Fixes for Maintenance Page */
        body.dark-mode .form-group select#issue-type {
            background-color: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--primary-blue);
        }

        body.dark-mode .form-group select#issue-type:hover {
            background-color: var(--bg-hover);
        }

        body.dark-mode .form-group select#issue-type option {
            background-color: var(--bg-card);
            color: var(--text-primary);
        }

        body.dark-mode .form-group textarea#issue-description {
            background-color: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--primary-blue);
        }

        body.dark-mode .form-group textarea#issue-description:hover {
            background-color: var(--bg-hover);
        }

        body.dark-mode .form-group .character-counter {
            color: var(--text-secondary);
        }

        body.dark-mode .announcement-item {
            background-color: var(--bg-card);
            border-color: var(--border-light);
        }

        body.dark-mode .announcement-item:hover {
            background-color: var(--bg-hover);
        }

        body.dark-mode .announcement-item .announcement-text h4 {
            color: var(--primary-blue);
        }

        body.dark-mode .announcement-item .announcement-text p {
            color: var(--text-primary);
        }

        body.dark-mode .announcement-item .announcement-text p small {
            color: var(--text-secondary);
        }

        body.dark-mode .announcement-item .toggle-description {
            color: var(--primary-blue);
        }

        body.dark-mode .announcement-item .full-description {
            color: var(--text-primary);
        }

        body.dark-mode .action-container {
            background-color: var(--bg-card);
            border-color: var(--border-light);
        }

        body.dark-mode .action-container .edit-form {
            background-color: var(--bg-card);
            border-color: var(--primary-blue);
        }

        body.dark-mode .action-container .edit-form select,
        body.dark-mode .action-container .edit-form textarea {
            background-color: var(--bg-card);
            color: var(--text-primary);
            border-color: var(--primary-blue);
        }

        body.dark-mode .action-container .edit-form .character-counter {
            color: var(--text-secondary);
        }

        /* Footer */
        main {
            flex: 1;
        }

        .footer {
            background-color: var(--primary-blue);
            color: var(--light-text);
            padding: 1rem 0;
            text-align: center;
            margin-top: auto;
        }

        .footer p {
            margin: 0;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 968px) {
            .sidebar-toggle {
                display: block;
            }
            
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.hidden {
                transform: translateX(-100%);
            }
            
            .sidebar:not(.hidden) {
                transform: translateX(0);
            }
            
            .admin-content {
                margin-left: 0;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            #profileModal .profile-modal {
                max-width: 95% !important;
                margin: 10px;
            }
            
            #profileModal .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            #profileModal .form-grid,
            #profileModal .profile-stats,
            #profileModal .preferences-grid {
                grid-template-columns: 1fr;
            }
            
            #profileModal .action-buttons {
                flex-direction: column;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Student Container -->
    <div id="studentContainer" class="show">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <button id="sidebarToggle" class="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="false">
                    <i class="fas fa-bars" aria-hidden="true"></i>
                </button>
                <h1><i class="fas fa-tools" aria-hidden="true"></i> <span id="page-title">Maintenance Requests</span></h1>
            </div>
            <div class="header-right">
                <div class="admin-profile" tabindex="0">
                    <img id="student-profile-img" src="https://ui-avatars.com/api/?name=Guest&background=4361ee&color=fff" alt="Student profile picture">
                    <span id="student-name"></span>
                    <i class="fas fa-chevron-down" aria-hidden="true"></i>
                </div>
            </div>
        </header>

        <!-- Student Profile Dropdown -->
        <div id="studentProfileDropdown" class="admin-profile-dropdown">
            <div class="dropdown-header">
                <img id="student-profile-img-dropdown" src="https://ui-avatars.com/api/?name=Guest&background=4361ee&color=fff" alt="Student profile picture">
                <div class="user-info">
                    <h4 id="student-name-dropdown"></h4>
                    <p id="student-email-dropdown"></p>
                    <span class="user-role">Student</span>
                </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item" id="view-profile-btn">
                <i class="fas fa-user" aria-hidden="true"></i>
                <span>View Profile</span>
            </a>
            <a href="#" class="dropdown-item" id="dark-mode-item">
                <i class="fas fa-moon" id="dark-mode-icon" aria-hidden="true"></i>
                <span>Dark Mode</span>
            </a>
            <a href="#" class="dropdown-item" id="student-settings">
                <i class="fas fa-cog" aria-hidden="true"></i>
                <span>Settings</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item logout-item" id="student-logout">
                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                <span>Logout</span>
            </a>
        </div>

        <!-- Student Body -->
        <div class="admin-body">
            <!-- Sidebar -->
            <aside class="sidebar hidden">
                <nav class="sidebar-nav">
                    <a href="student.html" class="nav-item" data-page="dashboard">
                        <i class="fas fa-home" aria-hidden="true"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="room.html" class="nav-item" data-page="room">
                        <i class="fas fa-bed" aria-hidden="true"></i>
                        <span>Rooms</span>
                    </a>
                    <a href="payments.html" class="nav-item" data-page="payments">
                        <i class="fas fa-money-check-alt" aria-hidden="true"></i>
                        <span>Payments</span>
                    </a>
                    <a href="maintenance.html" class="nav-item active" data-page="maintenance">
                        <i class="fas fa-tools" aria-hidden="true"></i>
                        <span>Maintenance</span>
                    </a>
                    <a href="announcements.html" class="nav-item" data-page="announcements">
                        <i class="fas fa-bullhorn" aria-hidden="true"></i>
                        <span>Announcements</span>
                    </a>
                </nav>
            </aside>

            <!-- Maintenance Content -->
            <main class="admin-content expanded" id="pageContent">
                <h2 class="section-title">Maintenance Requests</h2>
                <p>Submit and track maintenance issues for your room or boarding house facilities.</p>
                <div class="dashboard-grid">
                    <!-- Submit Maintenance Request -->
                    <div class="dashboard-card">
                        <h3>Submit a Maintenance Request</h3>
                        <form id="maintenance-form">
                            <div class="form-group">
                                <label for="issue-type">Issue Type</label>
                                <select id="issue-type" name="issue-type" required aria-describedby="issue-type-desc">
                                    <option value="" disabled selected>Select issue type</option>
                                    <option value="Plumbing">Plumbing</option>
                                    <option value="Electrical">Electrical</option>
                                    <option value="Furniture">Furniture</option>
                                    <option value="Other">Other</option>
                                </select>
                                <p id="issue-type-desc" class="sr-only">Select the type of maintenance issue, such as plumbing or electrical.</p>
                            </div>
                            <div class="form-group">
                                <label for="issue-description">Description</label>
                                <textarea id="issue-description" name="issue-description" rows="4" maxlength="500" placeholder="Describe the issue in detail (e.g., location, severity, when it started)..." required aria-describedby="issue-description-counter"></textarea>
                                <div class="character-counter" id="issue-description-counter">0/500</div>
                            </div>
                            <button type="submit" class="action-btn">Submit Request</button>
                        </form>
                    </div>
                    <!-- Maintenance Requests List -->
                    <div class="dashboard-card">
                        <h3>My Maintenance Requests</h3>
                        <div id="maintenance-list" class="announcements-scroll">
                            <p id="no-requests" style="display: none;">No maintenance requests submitted.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <p>&copy; 2025 DSSC Boarding House. All rights reserved.</p>
            </div>
        </footer>
    </head>

        <!-- Student Profile Dropdown -->
        <div id="studentProfileDropdown" class="admin-profile-dropdown">
            <div class="dropdown-header">
                <img id="student-profile-img-dropdown" src="https://ui-avatars.com/api/?name=Guest&background=4361ee&color=fff" alt="Student profile picture">
                <div class="user-info">
                    <h4 id="student-name-dropdown"></h4>
                    <p id="student-email-dropdown"></p>
                    <span class="user-role">Student</span>
                </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item" id="view-profile-btn">
                <i class="fas fa-user" aria-hidden="true"></i>
                <span>View Profile</span>
            </a>
            <a href="#" class="dropdown-item" id="dark-mode-item">
                <i class="fas fa-moon" id="dark-mode-icon" aria-hidden="true"></i>
                <span>Dark Mode</span>
            </a>
            <a href="#" class="dropdown-item" id="student-settings">
                <i class="fas fa-cog" aria-hidden="true"></i>
                <span>Settings</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item logout-item" id="student-logout">
                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                <span>Logout</span>
            </a>
        </div>

        <!-- Student Body -->
        <div class="admin-body">
            <!-- Sidebar -->
            <aside class="sidebar hidden">
                <nav class="sidebar-nav">
                    <a href="student.html" class="nav-item" data-page="dashboard">
                        <i class="fas fa-home" aria-hidden="true"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="room.html" class="nav-item" data-page="room">
                        <i class="fas fa-bed" aria-hidden="true"></i>
                        <span>Rooms</span>
                    </a>
                    <a href="payments.html" class="nav-item" data-page="payments">
                        <i class="fas fa-money-check-alt" aria-hidden="true"></i>
                        <span>Payments</span>
                    </a>
                    <a href="maintenance.html" class="nav-item active" data-page="maintenance">
                        <i class="fas fa-tools" aria-hidden="true"></i>
                        <span>Maintenance</span>
                    </a>
                    <a href="announcements.html" class="nav-item" data-page="announcements">
                        <i class="fas fa-bullhorn" aria-hidden="true"></i>
                        <span>Announcements</span>
                    </a>
                </nav>
            </aside>

            <!-- Maintenance Content -->
            <main class="admin-content expanded" id="pageContent">
                <h2 class="section-title">Maintenance Requests</h2>
                <p>Submit and track maintenance issues for your room or boarding house facilities.</p>
                <div class="dashboard-grid">
                    <!-- Submit Maintenance Request -->
                    <div class="dashboard-card">
                        <h3>Submit a Maintenance Request</h3>
                        <form id="maintenance-form">
                            <div class="form-group">
                                <label for="issue-type">Issue Type</label>
                                <select id="issue-type" name="issue-type" required aria-describedby="issue-type-desc">
                                    <option value="" disabled selected>Select issue type</option>
                                    <option value="Plumbing">Plumbing</option>
                                    <option value="Electrical">Electrical</option>
                                    <option value="Furniture">Furniture</option>
                                    <option value="Other">Other</option>
                                </select>
                                <p id="issue-type-desc" class="sr-only">Select the type of maintenance issue, such as plumbing or electrical.</p>
                            </div>
                            <div class="form-group">
                                <label for="issue-description">Description</label>
                                <textarea id="issue-description" name="issue-description" rows="4" maxlength="500" placeholder="Describe the issue in detail (e.g., location, severity, when it started)..." required aria-describedby="issue-description-counter"></textarea>
                                <div class="character-counter" id="issue-description-counter">0/500</div>
                            </div>
                            <button type="submit" class="action-btn">Submit Request</button>
                        </form>
                    </div>
                    <!-- Maintenance Requests List -->
                    <div class="dashboard-card">
                        <h3>My Maintenance Requests</h3>
                        <div id="maintenance-list" class="announcements-scroll">
                            <p id="no-requests" style="display: none;">No maintenance requests submitted.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <p>&copy; 2025 DSSC Boarding House. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <script>
    $(document).ready(function() {
        try {
            console.log('maintenance.js loaded');

            // Initialize student data
            const currentUser = JSON.parse(localStorage.getItem('currentUser')) || { name: 'Guest', email: 'guest@dssc.edu.ph' };
            const selectedRoom = JSON.parse(localStorage.getItem('selectedRoom'));
            const storageKey = `maintenanceRequests_${currentUser.email}`; // User-specific storage key

            window.studentData = window.studentData || {
                name: currentUser.name,
                email: currentUser.email,
                room: selectedRoom,
                maintenanceRequests: JSON.parse(localStorage.getItem(storageKey)) || []
            };

            console.log('Current user:', currentUser);
            console.log('Student data initialized:', window.studentData);

            // Update UI with user data - FIXED: Force update all avatar locations
            $('#student-name, #student-name-dropdown').text(currentUser.name);
            $('#student-email-dropdown').text(currentUser.email);
            
            // Create avatar URL with current name
            const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.name)}&background=4361ee&color=fff`;
            console.log('Avatar URL:', avatarUrl);
            
            // Update ALL avatar images
            $('#student-profile-img').attr('src', avatarUrl);
            $('#student-profile-img-dropdown').attr('src', avatarUrl);

            // Render maintenance requests
            const $maintenanceList = $('#maintenance-list');
            const $noRequests = $('#no-requests');

            function renderMaintenanceRequests() {
                // Filter requests to show only those belonging to the current user
                const requests = window.studentData.maintenanceRequests.filter(request => request.userEmail === currentUser.email);
                if (requests.length === 0) {
                    $noRequests.show();
                    $maintenanceList.empty();
                    return;
                }

                $noRequests.hide();
                let requestHtml = '';
                requests.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(request => {
                    const truncatedDescription = request.description.length > 100 
                        ? request.description.substring(0, 100) + '...' 
                        : request.description;
                    requestHtml += `
                        <div class="announcement-item" data-id="${request.id}" role="button" aria-expanded="false">
                            <div class="announcement-content">
                                <i class="fas fa-tools icon"></i>
                                <div class="announcement-text">
                                    <h4>${request.type}</h4>
                                    <p class="short-description">${truncatedDescription}</p>
                                    <p class="full-description">${request.description}</p>
                                    <span class="toggle-description" role="button" aria-expanded="false">${request.description.length > 100 ? 'Show more' : ''}</span>
                                    <p><small>Submitted on ${request.date} | Status: <span class="status-${request.status.toLowerCase()}">${request.status}</span></small></p>
                                </div>
                            </div>
                            <div class="action-container" data-id="${request.id}">
                                <div class="action-buttons">
                                    <button class="edit-btn" aria-label="Edit request for ${request.type}" data-id="${request.id}">
                                        <i class="fas fa-pencil-alt"></i> Edit
                                    </button>
                                    <button class="delete-btn" aria-label="Delete request for ${request.type}" data-id="${request.id}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                    <button class="cancel-btn" aria-label="Cancel actions for ${request.type}" data-id="${request.id}">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                                <form class="edit-form" data-id="${request.id}">
                                    <div class="form-group">
                                        <label for="edit-issue-type-${request.id}">Issue Type</label>
                                        <select id="edit-issue-type-${request.id}" name="edit-issue-type" required>
                                            <option value="Plumbing" ${request.type === 'Plumbing' ? 'selected' : ''}>Plumbing</option>
                                            <option value="Electrical" ${request.type === 'Electrical' ? 'selected' : ''}>Electrical</option>
                                            <option value="Furniture" ${request.type === 'Furniture' ? 'selected' : ''}>Furniture</option>
                                            <option value="Other" ${request.type === 'Other' ? 'selected' : ''}>Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="edit-issue-description-${request.id}">Description</label>
                                        <textarea id="edit-issue-description-${request.id}" name="edit-issue-description" rows="4" maxlength="500" required>${request.description}</textarea>
                                        <div class="character-counter" id="edit-issue-description-counter-${request.id}">${request.description.length}/500</div>
                                    </div>
                                    <button type="submit" class="save-btn">Save</button>
                                    <button type="button" class="cancel-btn">Cancel</button>
                                </form>
                            </div>
                        </div>
                    `;
                });
                $maintenanceList.html(requestHtml);

                // Handle request click to toggle action container
                $('.announcement-item').on('click', function(e) {
                    e.stopPropagation();
                    const $this = $(this);
                    const requestId = $this.data('id');
                    const $actionContainer = $this.find(`.action-container[data-id="${requestId}"]`);
                    const $editForm = $actionContainer.find(`.edit-form[data-id="${requestId}"]`);
                    const isExpanded = $this.attr('aria-expanded') === 'true';

                    // Do not toggle if edit form is visible
                    if ($editForm.is(':visible')) {
                        return;
                    }

                    // Close all other action containers
                    $('.announcement-item').not($this).attr('aria-expanded', 'false');
                    $('.action-container').not($actionContainer).hide().find('.edit-form').hide();

                    if (isExpanded) {
                        $actionContainer.hide();
                        $this.attr('aria-expanded', 'false');
                    } else {
                        $actionContainer.show();
                        $this.attr('aria-expanded', 'true');
                    }
                });

                // Handle toggle description
                $('.toggle-description').on('click', function(e) {
                    e.stopPropagation();
                    const $this = $(this);
                    const $parent = $this.closest('.announcement-text');
                    const $shortDesc = $parent.find('.short-description');
                    const $fullDesc = $parent.find('.full-description');
                    const isExpanded = $this.attr('aria-expanded') === 'true';

                    if (isExpanded) {
                        $shortDesc.show();
                        $fullDesc.hide();
                        $this.text('Show more').attr('aria-expanded', 'false');
                    } else {
                        $shortDesc.hide();
                        $fullDesc.show();
                        $this.text('Show less').attr('aria-expanded', 'true');
                    }
                });

                // Handle edit button
                $('.edit-btn').on('click', function(e) {
                    e.stopPropagation();
                    const $this = $(this);
                    const requestId = $this.data('id');
                    const $parent = $this.closest('.announcement-item');
                    const $actionContainer = $parent.find(`.action-container[data-id="${requestId}"]`);
                    const $form = $actionContainer.find(`.edit-form[data-id="${requestId}"]`);

                    $actionContainer.find('.action-buttons').hide();
                    $form.show();
                    $form.find(`#edit-issue-description-${requestId}`).focus();
                });

                // Handle cancel button (both action container and edit form)
                $('.cancel-btn').on('click', function(e) {
                    e.stopPropagation();
                    const $this = $(this);
                    const $parent = $this.closest('.announcement-item');
                    const $actionContainer = $this.closest('.action-container');
                    const $form = $actionContainer.find('.edit-form');

                    if ($form.is(':visible')) {
                        $form.hide();
                        $actionContainer.find('.action-buttons').show();
                    } else {
                        $actionContainer.hide();
                        $parent.attr('aria-expanded', 'false');
                    }
                });

                // Handle edit form submission
                $('.edit-form').on('submit', function(e) {
                    e.preventDefault();
                    const $this = $(this);
                    const requestId = $this.data('id');
                    const issueType = $this.find(`select[name="edit-issue-type"]`).val();
                    const description = $this.find(`textarea[name="edit-issue-description"]`).val();

                    if (!issueType || !description) {
                        console.error('Please fill out all fields.');
                        return;
                    }

                    if (description.length > 500) {
                        console.error('Description cannot exceed 500 characters.');
                        return;
                    }

                    window.studentData.maintenanceRequests = window.studentData.maintenanceRequests.map(request => {
                        if (request.id === requestId && request.userEmail === currentUser.email) {
                            return {
                                ...request,
                                type: issueType,
                                description: description,
                                date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
                            };
                        }
                        return request;
                    });

                    localStorage.setItem(storageKey, JSON.stringify(window.studentData.maintenanceRequests));
                    renderMaintenanceRequests();
                    console.log('Maintenance request updated successfully!');
                });

                // Handle delete button
                $('.delete-btn').on('click', function(e) {
                    e.stopPropagation();
                    const requestId = $(this).data('id');
                    window.studentData.maintenanceRequests = window.studentData.maintenanceRequests.filter(request => 
                        !(request.id === requestId && request.userEmail === currentUser.email));
                    localStorage.setItem(storageKey, JSON.stringify(window.studentData.maintenanceRequests));
                    renderMaintenanceRequests();
                });

                // Character counter for edit form
                $('textarea[name="edit-issue-description"]').on('input', function() {
                    const $this = $(this);
                    const count = $this.val().length;
                    const requestId = $this.closest('.edit-form').data('id');
                    const $counter = $(`#edit-issue-description-counter-${requestId}`);
                    $counter.text(`${count}/500`);
                    if (count > 500) {
                        $counter.addClass('error');
                    } else {
                        $counter.removeClass('error');
                    }
                });
            }

            // Initial render
            renderMaintenanceRequests();

            // Character counter for main form
            $('#issue-description').on('input', function() {
                const $this = $(this);
                const count = $this.val().length;
                const $counter = $('#issue-description-counter');
                $counter.text(`${count}/500`);
                if (count > 500) {
                    $counter.addClass('error');
                } else {
                    $counter.removeClass('error');
                }
            });

            // Handle main form submission
            $('#maintenance-form').on('submit', function(e) {
                e.preventDefault();
                const issueType = $('#issue-type').val();
                const description = $('#issue-description').val();

                if (!issueType || !description) {
                    console.error('Please fill out all fields.');
                    return;
                }

                if (description.length > 500) {
                    console.error('Description cannot exceed 500 characters.');
                    return;
                }

                const newRequest = {
                    id: (window.studentData.maintenanceRequests.length || 0) + 1, // Simple ID generation
                    type: issueType,
                    description: description,
                    date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                    status: 'Pending',
                    userEmail: currentUser.email // Associate with current user
                };

                window.studentData.maintenanceRequests.push(newRequest);
                localStorage.setItem(storageKey, JSON.stringify(window.studentData.maintenanceRequests));
                renderMaintenanceRequests();

                // Reset form
                $('#issue-type').val('');
                $('#issue-description').val('');
                $('#issue-description-counter').text('0/500').removeClass('error');
            });

            // Sidebar toggle
            $('#sidebarToggle').on('click', function() {
                $('.sidebar').toggleClass('hidden');
                $('.admin-content').toggleClass('expanded');
                const isHidden = $('.sidebar').hasClass('hidden');
                $(this).find('i').removeClass('fa-bars fa-times').addClass(isHidden ? 'fa-bars' : 'fa-times');
                $(this).attr('aria-expanded', !isHidden);
                console.log(isHidden ? 'Sidebar hidden' : 'Sidebar shown');
            });

            // Profile dropdown
            $('.admin-profile').on('click', function(e) {
                e.stopPropagation();
                const $dropdown = $('#studentProfileDropdown');
                const $profile = $(this);

                $dropdown.toggleClass('show');
                if ($dropdown.hasClass('show')) {
                    const profileOffset = $profile.offset();
                    const profileHeight = $profile.outerHeight();
                    $dropdown.css({
                        top: profileHeight + 10,
                        right: $(window).width() - (profileOffset.left + $profile.outerWidth())
                    });
                    console.log('Dropdown positioned at top:', profileHeight + 10, 'right:', $(window).width() - (profileOffset.left + $profile.outerWidth()));
                }
                console.log('Profile dropdown toggled');
            });

            // Close dropdown when clicking outside
            $(document).on('click', function(event) {
                const $dropdown = $('#studentProfileDropdown');
                const $profile = $('.admin-profile');
                if (!$dropdown.is(event.target) && !$dropdown.has(event.target).length &&
                    !$profile.is(event.target) && !$profile.has(event.target).length) {
                    $dropdown.removeClass('show');
                    console.log('Dropdown closed due to outside click');
                }
            });

            // View Profile Modal Functionality - FIXED
            function initializeProfileModal() {
                console.log('Initializing profile modal...');
                // Remove existing modal if any
                $('#profileModal').remove();
                
                // Get current user data directly from localStorage
                const currentUser = JSON.parse(localStorage.getItem('currentUser')) || { name: 'Guest', email: 'guest@dssc.edu.ph' };
                const selectedRoom = JSON.parse(localStorage.getItem('selectedRoom'));
                
                console.log('Profile modal - current user:', currentUser);
                
                // Create profile modal HTML with current user data
                const profileModalHTML = `
                    <div id="profileModal" class="modal-overlay">
                        <div class="modal profile-modal">
                            <div class="profile-header">
                                <div class="profile-avatar-container">
                                    <img id="profile-avatar-img" src="https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.name)}&background=4361ee&color=fff" alt="Profile picture" class="profile-avatar">
                                    <button class="change-avatar-btn" title="Change profile picture">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                </div>
                                <div class="profile-info-header">
                                    <h2 id="profile-modal-name">${currentUser.name}</h2>
                                    <p id="profile-modal-email">${currentUser.email}</p>
                                    <div class="profile-badges">
                                        <span class="profile-badge">Student</span>
                                        <span class="profile-badge" id="profile-room-badge">${selectedRoom ? `Room ${selectedRoom.roomCode}` : 'No Room'}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="profile-tabs">
                                <button class="profile-tab active" data-tab="personal">Personal Info</button>
                                <button class="profile-tab" data-tab="preferences">Preferences</button>
                                <button class="profile-tab" data-tab="activity">Activity</button>
                            </div>
                            
                            <!-- Personal Info Tab -->
                            <div class="tab-content active" id="personal-tab">
                                <form id="profile-form">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">Full Name</label>
                                            <input type="text" class="form-input" id="profile-name" value="${currentUser.name}" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-input" id="profile-email" value="${currentUser.email}" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Student ID</label>
                                            <input type="text" class="form-input" id="profile-student-id" value="STU-${Math.random().toString(36).substr(2, 8).toUpperCase()}" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Phone Number</label>
                                            <input type="tel" class="form-input" id="profile-phone" value="+63 912 345 6789" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Emergency Contact</label>
                                            <input type="text" class="form-input" id="profile-emergency-contact" value="Maria Santos" readonly>
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Emergency Phone</label>
                                            <input type="tel" class="form-input" id="profile-emergency-phone" value="+63 923 456 7890" readonly>
                                        </div>
                                        <div class="form-group full-width">
                                            <label class="form-label">Address</label>
                                            <input type="text" class="form-input" id="profile-address" value="123 Main Street, Dasmariñas City, Cavite" readonly>
                                        </div>
                                    </div>
                                    
                                    <div class="profile-stats">
                                        <div class="stat-item">
                                            <div class="stat-icon">
                                                <i class="fas fa-home"></i>
                                            </div>
                                            <span class="stat-number" id="stat-days-stayed">${selectedRoom ? '45' : '0'}</span>
                                            <span class="stat-label">Days Stayed</span>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-icon">
                                                <i class="fas fa-money-bill-wave"></i>
                                            </div>
                                            <span class="stat-number" id="stat-total-paid">₱${selectedRoom ? selectedRoom.price * 2 : '0'}</span>
                                            <span class="stat-label">Total Paid</span>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-icon">
                                                <i class="fas fa-star"></i>
                                            </div>
                                            <span class="stat-number" id="stat-rating">4.8</span>
                                            <span class="stat-label">Rating</span>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-icon">
                                                <i class="fas fa-calendar-check"></i>
                                            </div>
                                            <span class="stat-number" id="stat-bookings">${selectedRoom ? '1' : '0'}</span>
                                            <span class="stat-label">Bookings</span>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Preferences Tab -->
                            <div class="tab-content" id="preferences-tab">
                                <div class="preferences-grid">
                                    <div class="preference-item">
                                        <span>Email Notifications</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="preference-item">
                                        <span>SMS Notifications</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="preference-item">
                                        <span>Payment Reminders</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                    <div class="preference-item">
                                        <span>Maintenance Updates</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" class="toggle-checkbox" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Activity Tab -->
                            <div class="tab-content" id="activity-tab">
                                <div class="activity-list">
                                    <div class="activity-item">
                                        <div class="activity-icon">
                                            <i class="fas fa-key"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-title">Room Check-in</div>
                                            <div class="activity-time">${selectedRoom ? selectedRoom.bookedDate : 'Not booked yet'}</div>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon">
                                            <i class="fas fa-money-bill-wave"></i>
                                        </div>
                                        <div class="activity-content">
                                            <div class="activity-title">Payment Made</div>
                                            <div class="activity-time">Sep 15, 2025 - ₱${selectedRoom ? selectedRoom.price : '0'}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button type="button" class="btn btn-outline" id="cancel-edit-btn" style="display: none;">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                                <button type="button" class="btn btn-secondary" id="edit-profile-btn">
                                    <i class="fas fa-edit"></i> Edit Profile
                                </button>
                                <button type="button" class="btn btn-primary" id="save-profile-btn" style="display: none;">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                // Append modal to body
                $('body').append(profileModalHTML);
                
                // Set up event handlers
                setupProfileModalHandlers();
            }

            function setupProfileModalHandlers() {
                // Tab switching
                $(document).on('click', '.profile-tab', function() {
                    const tabId = $(this).data('tab');
                    
                    // Update active tab
                    $('.profile-tab').removeClass('active');
                    $(this).addClass('active');
                    
                    // Show corresponding content
                    $('.tab-content').removeClass('active');
                    $(`#${tabId}-tab`).addClass('active');
                });
                
                // Edit profile button
                $(document).on('click', '#edit-profile-btn', function() {
                    enableEditMode();
                });
                
                // Cancel edit button
                $(document).on('click', '#cancel-edit-btn', function() {
                    disableEditMode();
                    resetFormData();
                });
                
                // Save profile button
                $(document).on('click', '#save-profile-btn', function() {
                    saveProfileChanges();
                });
                
                // Close modal when clicking outside
                $(document).on('click', '#profileModal', function(e) {
                    if ($(e.target).hasClass('modal-overlay')) {
                        closeProfileModal();
                    }
                });
                
                // Change avatar button
                $(document).on('click', '.change-avatar-btn', function() {
                    // Avatar change functionality (no alert)
                });
            }

            function enableEditMode() {
                $('#profile-form').addClass('edit-mode');
                $('#profile-name, #profile-phone, #profile-emergency-contact, #profile-emergency-phone, #profile-address').prop('readonly', false);
                
                $('#edit-profile-btn').hide();
                $('#cancel-edit-btn').show();
                $('#save-profile-btn').show();
            }

            function disableEditMode() {
                $('#profile-form').removeClass('edit-mode');
                $('#profile-name, #profile-phone, #profile-emergency-contact, #profile-emergency-phone, #profile-address').prop('readonly', true);
                
                $('#edit-profile-btn').show();
                $('#cancel-edit-btn').hide();
                $('#save-profile-btn').hide();
            }

            function resetFormData() {
                // Get current user data
                const currentUser = JSON.parse(localStorage.getItem('currentUser')) || { name: 'Guest', email: 'guest@dssc.edu.ph' };
                
                // Reset form to original values
                $('#profile-name').val(currentUser.name);
                $('#profile-phone').val('+63 912 345 6789');
                $('#profile-emergency-contact').val('Maria Santos');
                $('#profile-emergency-phone').val('+63 923 456 7890');
                $('#profile-address').val('123 Main Street, Dasmariñas City, Cavite');
            }

            function saveProfileChanges() {
                // Get updated values
                const updatedName = $('#profile-name').val();
                const updatedPhone = $('#profile-phone').val();
                const updatedEmergencyContact = $('#profile-emergency-contact').val();
                const updatedEmergencyPhone = $('#profile-emergency-phone').val();
                const updatedAddress = $('#profile-address').val();
                
                // Update localStorage with new name
                const currentUser = JSON.parse(localStorage.getItem('currentUser')) || {};
                currentUser.name = updatedName;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Update student data
                window.studentData.name = updatedName;
                
                // Update UI throughout the app - UPDATE ALL LOCATIONS
                $('#student-name').text(updatedName); // Header name
                $('#student-name-dropdown').text(updatedName); // Dropdown name
                
                // Update avatar with new name - ALL locations
                const newAvatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(updatedName)}&background=4361ee&color=fff`;
                
                // Update avatar in ALL locations:
                $('#student-profile-img').attr('src', newAvatarUrl); // Header avatar
                $('#student-profile-img-dropdown').attr('src', newAvatarUrl); // Dropdown avatar
                $('#profile-avatar-img').attr('src', newAvatarUrl); // Profile modal avatar
                
                // Exit edit mode
                disableEditMode();
                
                // Close modal after saving
                closeProfileModal();
                
                console.log('Profile saved - avatar updated everywhere in maintenance page');
            }

            function openProfileModal() {
                console.log('Opening profile modal...');
                // Reinitialize modal with latest user data
                initializeProfileModal();
                
                // Force show the modal with a slight delay to ensure DOM is ready
                setTimeout(() => {
                    $('#profileModal').css('display', 'flex');
                    console.log('Profile modal should be visible now');
                }, 100);
            }

            function closeProfileModal() {
                $('#profileModal').css('display', 'none');
                disableEditMode(); // Ensure edit mode is disabled when closing
            }

            // Initialize profile modal
            initializeProfileModal();

            // View Profile button handler - FIXED: Use delegated event handler
            $(document).on('click', '#view-profile-btn', function(e) {
                e.preventDefault();
                console.log('=== VIEW PROFILE CLICKED ===');
                
                // Close dropdown first
                $('#studentProfileDropdown').removeClass('show');
                
                // Get fresh user data
                const currentUser = JSON.parse(localStorage.getItem('currentUser')) || { name: 'Guest', email: 'guest@dssc.edu.ph' };
                console.log('Current user for modal:', currentUser);
                
                // Reinitialize modal with latest data
                initializeProfileModal();
                
                // Show modal with slight delay to ensure DOM is ready
                setTimeout(() => {
                    $('#profileModal').css('display', 'flex');
                    console.log('Modal display set to flex');
                }, 50);
            });

            // Dark Mode Functionality
            function initializeDarkMode() {
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                
                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    document.body.classList.add('dark-mode');
                }
                updateDarkModeIcon();
            }

            function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                const isDarkMode = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                updateDarkModeIcon();
            }

            function updateDarkModeIcon() {
                const isDarkMode = document.body.classList.contains('dark-mode');
                const darkModeIcon = $('#dark-mode-icon');
                
                if (darkModeIcon.length) {
                    darkModeIcon.removeClass('fa-moon fa-sun');
                    darkModeIcon.addClass(isDarkMode ? 'fa-sun' : 'fa-moon');
                    $('#dark-mode-item span').text(isDarkMode ? 'Light Mode' : 'Dark Mode');
                }
            }

            // Initialize when page loads
            initializeDarkMode();

            // Add click handler
            $(document).on('click', '#dark-mode-item', function(e) {
                e.preventDefault();
                toggleDarkMode();
                $('#studentProfileDropdown').removeClass('show');
            });

            // Logout
            $('#student-logout').on('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('currentUser');
                localStorage.removeItem('justLoggedIn');
                localStorage.removeItem('selectedRoom');
                // Do not clear maintenanceRequests to allow admin access in the future
                window.location.href = '../index.html';
            });
        } catch (error) {
            console.error('Error in maintenance.js:', error);
            $('#studentContainer').addClass('show').css({ display: 'block' });
        }
    });
    </script>
</body>
</html>